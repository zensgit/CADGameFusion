{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://cadgamefusion.io/schemas/project.schema.json",
  "title": "CADGameFusion Project v1",
  "type": "object",
  "additionalProperties": false,
  "required": ["header", "project", "scene", "featureTree", "resources"],
  "$defs": {
    "point": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "type", "params"],
      "properties": {
        "id": {"type": "string"},
        "type": {"const": "point"},
        "params": {
          "type": "object",
          "additionalProperties": false,
          "required": ["x", "y"],
          "properties": {"x": {"type": "number"}, "y": {"type": "number"}}
        }
      }
    },
    "line": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "type", "params"],
      "properties": {
        "id": {"type": "string"},
        "type": {"const": "line"},
        "params": {
          "type": "object",
          "additionalProperties": false,
          "required": ["p0", "p1"],
          "properties": {"p0": {"type": "string"}, "p1": {"type": "string"}}
        }
      }
    },
    "circle": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "type", "params"],
      "properties": {
        "id": {"type": "string"},
        "type": {"const": "circle"},
        "params": {
          "type": "object",
          "additionalProperties": false,
          "required": ["center", "radius"],
          "properties": {"center": {"type": "string"}, "radius": {"type": "number", "exclusiveMinimum": 0}}
        }
      }
    },
    "arc": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "type", "params"],
      "properties": {
        "id": {"type": "string"},
        "type": {"const": "arc"},
        "params": {
          "type": "object",
          "additionalProperties": false,
          "required": ["center", "radius", "startAngle", "endAngle"],
          "properties": {
            "center": {"type": "string"},
            "radius": {"type": "number", "exclusiveMinimum": 0},
            "startAngle": {"type": "number"},
            "endAngle": {"type": "number"}
          }
        }
      }
    },
    "rect": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "type", "params"],
      "properties": {
        "id": {"type": "string"},
        "type": {"const": "rect"},
        "params": {
          "type": "object",
          "additionalProperties": false,
          "required": ["p0", "p1"],
          "properties": {"p0": {"type": "string"}, "p1": {"type": "string"}}
        }
      }
    },
    "constraintBase": {
      "type": "object",
      "required": ["id", "type", "refs"],
      "properties": {
        "id": {"type": "string"},
        "type": {"type": "string"},
        "refs": {"type": "array", "items": {"type": "string"}}
      }
    },
    "c_no_value": {
      "allOf": [
        {"$ref": "#/$defs/constraintBase"},
        { "type": "object",
          "properties": {
            "id": {"type": "string"},
            "type": {"type": "string"},
            "refs": {"type": "array", "items": {"type": "string"}},
            "value": {"type": "null"}
          },
          "additionalProperties": false
        }
      ]
    },
    "c_value_num": {
      "allOf": [
        {"$ref": "#/$defs/constraintBase"},
        { "type": "object",
          "properties": {
            "id": {"type": "string"},
            "type": {"type": "string"},
            "refs": {"type": "array", "items": {"type": "string"}},
            "value": {"type": "number"}
          },
          "required": ["value"],
          "additionalProperties": false
        }
      ]
    }
  },
  "properties": {
    "header": {
      "type": "object",
      "additionalProperties": false,
      "required": ["format", "version"],
      "properties": {
        "format": {"type": "string", "const": "CADGF-PROJ"},
        "version": {"type": "integer", "minimum": 1}
      }
    },
    "project": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "units"],
      "properties": {
        "id": {"type": "string"},
        "name": {"type": "string"},
        "created": {"type": "string"},
        "modified": {"type": "string"},
        "units": {"type": "string", "enum": ["mm", "cm", "m", "inch", "ft"]}
      }
    },
    "scene": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "entities": {
          "type": "array",
          "items": {
            "oneOf": [
              {"$ref": "#/$defs/point"},
              {"$ref": "#/$defs/line"},
              {"$ref": "#/$defs/circle"},
              {"$ref": "#/$defs/arc"},
              {"$ref": "#/$defs/rect"}
            ]
          }
        },
        "constraints": {
          "type": "array",
          "items": {
            "oneOf": [
              {"allOf": [
                {"$ref": "#/$defs/c_no_value"},
                {"properties": {"type": {"enum": ["horizontal", "vertical", "parallel", "perpendicular", "equal", "concentric", "coincident"]}}}
              ]},
              {"allOf": [
                {"$ref": "#/$defs/c_value_num"},
                {"properties": {"type": {"enum": ["distance", "angle"]}}}
              ]}
            ]
          }
        },
        "parameters": {"type": "object"}
      }
    },
    "featureTree": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "nodes": {"type": "array", "items": {"type": "object"}},
        "edges": {"type": "array", "items": {"type": "object"}}
      }
    },
    "resources": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "sketches": {"type": "array", "items": {"type": "object"}},
        "meshes": {"type": "array", "items": {"type": "object"}},
        "materials": {"type": "array", "items": {"type": "object"}}
      }
    },
    "meta": {"type": "object"}
  }
}
